# Fluentd configuration for Jira MCP Server log aggregation
# Collects application logs and forwards them to Prometheus/Grafana

<source>
  @type tail
  path /var/log/jira-mcp/*.log
  pos_file /var/log/fluentd-buffers/jira-mcp.log.pos
  tag jira-mcp.*
  format json
  read_from_head true
  refresh_interval 10
</source>

<source>
  @type tail
  path /var/log/jira-mcp/error.log
  pos_file /var/log/fluentd-buffers/jira-mcp-error.log.pos
  tag jira-mcp.error
  format json
  read_from_head true
  refresh_interval 10
</source>

# Forward logs to stdout for debugging
<match jira-mcp.**>
  @type copy
  <store>
    @type stdout
    <format>
      @type json
    </format>
  </store>
  <store>
    @type prometheus
    <metric>
      name fluentd_input_status_num_records_total
      type counter
      desc The total number of incoming records
    </metric>
  </store>
</match>

# Health check endpoint
<source>
  @type http
  port 9880
  bind 0.0.0.0
</source>

<system>
  log_level info
</system>
